extends layout

block content
  .spacer
  .row
    .span8
      h3 Reports 
        small Questa pagina visualizza i report su iscrizioni e fruizioni dei corsi.
      
  hr

  .row
    .span12
      
      if message.length
        .alert.alert-success.alert-block
          p #{message}
      
      if error.length > 0
        .alert.alert-danger.alert-block
          p #{error}
      
      if reports.length > 0
        table.table.table-striped#user-table
          thead
            tr
              th.span3(style="width: auto;") Utente
              th.span4(style="width: auto;") Nome corso
              th.span1.text-center(style="width: auto;") Stato iscrizione
              th.span6(style="width: auto;") Ultimo evento
              th.span1(style="width: 210px;") &nbsp;
          tbody
            each report in reports
              if users[report.user_id] && users[report.user_id] && report.events && report.events.length > 0
                tr
                  td 
                    a(href='/courses/form/#{report.user_id}') #{users[report.user_id][0].name}
                  td 
                    a(href='/courses/form/#{report.course_id}') #{courses[report.course_id][0].name}
                  td.text-center.avoid-search
                    if users[report.user_id][0].enabled && courses[report.course_id][0].enabled
                      img.image-icon(src='/img/icon-status-ok.png', title='Utente e corso sono attivi')
                    else
                      img.image-icon(src='/img/icon-status-error.png', title='Utente o corso non sono attivi.')
                  
                  td.avoid-search
                    | #{report.events[report.events.length - 1].description}
                    |  (#{moment(report.events[report.events.length - 1].created_on).fromNow()})

                  td.actions.avoid-search
                    a.btn.btn-small(href='/reports/#{report._id}')
                      i.icon-th-list.icon-white
                      | Dettagli
                  
              else
                tr.error
                  td.text-center(colspan=4) 
                    small 
                      strong Si Ã¨ verificato un errore
                      | , dovresti contattare il supporto fornendo questo riferimento: #{report._id}.
                  
                  td.actions.avoid-search
                    a.btn.btn-small(href='/reports/#{report._id}')
                      i.icon-th-list.icon-white
                      | Dettagli
      
      else
        p.alert.alert-info Nessun report da visualizzare.

